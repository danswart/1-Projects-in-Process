---
title: "How to Build Titles and Subtitles in Shiny"
subtitle: ""
description: ""
author: 
  - name: "Dan Swart, CPA (ret)"
    affiliations:
      - "SCUC-ISD Board of Trustees"
      - "Seat 6"
date: today
date-format: long
# bibliography: manual-refs.bib
format:
  html:
    resources:
      - reference-backlinks.js
    include-after-body:    
      - text: |
          # <script type="text/javascript" src="reference-backlinks.js"></script>
    default: true         
    code-copy: true
    code-link: true        # This adds individual buttons
    code-fold: true        # Hide code by default, show on click
    code-summary: "Show the code"
    code-overflow: wrap
    code-block-bg: "#FAEBD7"
    code-block-border-left: "#31BAE9"
    embed-resources: true
    include-in-header: header.html
    css:
      - swart.css
      - tachyons.min.css
      - r-colors.css
    fontsize: 18pt
    lightbox: true
    page-layout: full
    fig-width: 12
    fig-height: 10
    fig-dpi: 300
    html-math-method: katex
    df-print: paged
    toc: true
    toc-float: true
    citeproc: true
    link-citations: true
    linestretch: 1.0
    
    
    
  typst:
    fig-width: 12
    fig-height: 10
    fig-dpi: 300
    margin:
      x: 1in
      y: 1in
    toc: true
    fontsize: 14pt
    mainfont: "Cabin"
    
  revealjs:
    slide-number: true
    transition: fade
    code-overflow: wrap
    center: true
    smaller: true
    scrollable: true
    chalkboard: true
    multiplex: false
    theme: solarized
    reference-location: margin
    logo: img/red-cross-640-435.png
    footer: "Footer text"
    code-block-height: 650px



  # docx:
  #   highlight-style: github
  #   fig_caption: true



editor: source

quarto:
  render:
    cache-refresh: true


# for .qmd filesd
execute:
  echo: false
  message: false
  warning: false
  eval: true
  fig-width: 12
  fig-height: 10


# for .rmd files
knitr:
  opts_chunk:
    echo: false
    error: false
    warning: false
    message: false
    cache: false

---


```{r}
#| label: setup
#| include: false
# R version 4.4.3 (2025-02-28)
# Platform: x86_64-apple-darwin20
# Running under: macOS Sequoia 15.6.1
# Rstudio 2025.9.2.418 (Cucumberleaf Sunflower)
# 

# Prevent scientific notation globally
options(scipen = 999)
options(device = "quartz")  # macOS native graphics device
options(tigris_use_cache = TRUE)

# install.packages(c("mapview", "survey", "srvyr", "arcgislayers"))

# census_api_key("95496766c51541ee6f402c1e1a8658581285b759", install = TRUE, overwrite = TRUE)


# load libraries

# library(BayesFactor) # Computation of Bayes Factors for Common Designs
# library(boot) # Bootstrap Functions
# library(broom) # Convert Statistical Objects into Tidy Tibbles
# library(camcorder) # Record Your Plot History
# library(car) # Companion to Applied Regression
# library(corrplot) # Visualization of a Correlation Matrix
# library(cowplot) # Streamlined Plot Theme and Plot Annotations for 'ggplot2'
# library(dagitty) # Graphical Analysis of Structural Causal Models  
# library(DiagrammeR) # Graph/Network Visualization 
# library(dlookr) # Tools for Data Diagnosis, Exploration, Transformation       
# library(DT) # A Wrapper of the JavaScript Library 'DataTables'
# library(dutchmasters) # Color Palettes based on Famous Paintings 
# library(flexdashboard) # R Markdown Format for Flexible Dashboards
# library(flextable) # Functions for Tabular Reporting  
# library(forcats) # Tools for Working with Categorical Variables (Factors)
# library(gganimate) # A Grammar of Animated Graphics
# library(ggcorrplot) # Visualization of a Correlation Matrix using 'ggplot2'
# library(ggdag) # Analyze and Create Elegant Directed Acyclic Graphs      
# library(ggforce) # Accelerating 'ggplot2' 
# library(gghighlight) # Highlight Lines and Points in 'ggplot2' 
# library(ggplot2) # Create Elegant Data Visualizations Using the Grammar of Graphics
# library(ggokabeito) # 'Okabe-Ito' Scales for 'ggplot2' and 'ggraph'
# library(ggpubr) # 'ggplot2' Based Publication Ready Plots
# library(ggrepel) # Automatically Position Non-Overlapping Text Labels with 'ggplot2'
# library(ggtext) # Improved Text Rendering Support for 'ggplot2' 
# library(ggthemes) # Extra Themes, Scales and Geoms for 'ggplot2'
# library(glue) # Interpreted String Literals    
# library(grid) # The Grid Graphics Package
# library(gt) # Easily Create Presentation-Ready Display Tables
# library(gtExtras) # Extending 'gt' for Beautiful HTML Tables
# library(haven) # Import and Export 'SPSS', 'Stata' and 'SAS' Files
# library(here) # A Simpler Way to Find Your Files
# library(htmltools) # Tools for HTML
# library(htmlwidgets) # HTML Widgets for R
# library(janitor) # Simple Tools for Examining and Cleaning Dirty Data 
# library(kableExtra) # Construct Complex Table with 'kable' and Pipe Syntax
# library(knitr) # A General-Purpose Package for Dynamic Report Generation in R   
# library(lavaan) # Latent Variable Analysis     
# library(lubridate) # Make Dealing with Dates a Little Easier
# library(monochromeR) # Easily Create, View and Use Monochrome Color Palettes 
# library(paletteer) # Comprehensive Collection of Color Palettes 
# library(patchwork) # The Composer of Plots
# library(plotly) # Create Interactive Web Graphics via 'plotly.js'
# library(ppcor) # Partial and Semi-Partial (Part) Correlation
# library(prettycode) # Pretty Print R Code in the Terminal
# library(purrr) # Functional Programming Tools
# library(pwr) # Basic Functions for Power Analysis
# library(qgraph) # Graph Plotting Methods, Psychometric Data Visualization and Graphical Model Estimation
# library(qicharts2) # Quality Improvement Charts
# library(RColorBrewer) # ColorBrewer Palettes 
# library(readr) # Read Rectangular Text Data
# library(readxl) # Read Excel Files
# library(rethinking) # Statistical Rethinking book package
# library(rlang) # Functions for Base Types and Core R and 'Tidyverse' Features
# library(scales) # Scale Functions for Visualization
# library(shiny) # Web Application Framework for R
# library(shinyobjects) # Access Reactive Data Interactively   
# library(skimr) # Compact and Flexible Summaries of Data
# library(stringr) # Simple, Consistent Wrappers for Common String Operations
# library(tibble) # Simple Data Frames
# library(tidycensus) # Load US Census Boundary and Attribute Data as 'tidyverse' and 'sf'-Ready Data Frames
# library(tidylog) # Logging for 'dplyr' and 'tidyr' Functions
# library(tidyr) # Tidy Messy Data
# library(tidytext) # Text Mining using 'dplyr', 'ggplot2', and Other Tidy Tools 
# library(tsibble) # Tidy Temporal Data Frames and Tools        
# library(viridis) # Colorblind-Friendly Color Maps for R 
# library(visdat) # Preliminary Visualization of Data
# library(vroom) # Read and Write Rectangular Text Data Quickly    
# library(wesanderson) # A Wes Anderson Palette Generator 
# library(writexl) # Export Data Frames to Excel 'xlsx' Format 
# library(WRS2) # A Collection of Robust Statistical Methods



# Force dplyr's select to take precedence
select <- dplyr::select
filter <- dplyr::filter

# Options
options(scipen = 999)
options(qic.clshade = T) # NO LONGER NEEDED; CHARTS ALL PREPARED WITH GGPLOT2 ONLY
options(qic.linecol = 'black') # NO LONGER NEEDED; CHARTS ALL PREPARED WITH GGPLOT2 ONLY
options(qic.signalcol = "red") # NO LONGER NEEDED; CHARTS ALL PREPARED WITH GGPLOT2 ONLY
options(qic.targetcol = "purple") # NO LONGER NEEDED; CHARTS ALL PREPARED WITH GGPLOT2 ONLY
options(DT.options = list(dom = 'pBlfrti')) # Add buttons, filtering, and top (t) pagination controls
options(shiny.maxRequestSize = 50 * 1024^2) # Set upload maximum to 50 MB
options(tigris_use_cache = TRUE)


# Set global theme for consistent plots
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 20) + 
                   ggplot2::theme(plot.title = ggplot2::element_text(face = "bold",
                                                                      size = 26),
                                  plot.subtitle = ggplot2::element_text(face = "bold",
                                                                         size = 24),
                                  axis.title.x = ggplot2::element_text(face = "bold",
                                                                        size = 22),
                                  axis.title.y = ggplot2::element_text(face = "bold",
                                                                        size = 22),
                                  axis.text.x = ggplot2::element_text(face = "bold",
                                                                       size = 22,
                                                                       angle = 45,
                                                                       hjust = 1),
                                  legend.position = "bottom",
                                  strip.text = ggplot2::element_text(face = "bold"),
                                  panel.spacing.x = grid::unit(1.5,
                                                                "cm"),
                                  panel.spacing.y = grid::unit(1.5,
                                                                "cm"),
                                  plot.margin = ggplot2::margin(20,
                                                                 20,
                                                                 20,
                                                                 20,
                                                                 "pt")))


# Set seed for reproducibility
set.seed(123)

```


<br>

## Here's a step-by-step explanation of how the title and subtitle are created and displayed in this advanced line plot code.  It assumes the plotting code utilizes a 'group' argument to create the plot.
<br>

The dataframe chosen by the User is monitored and updated by the Server.

```{r}
#| eval: false
#| echo: true

# File upload chooser button
fileInput(inputId = "file_chosen",
          label = "Choose a CVS File",
          accept = c(".csv")) 


# File upload observer feeds 'column_data' to global data storage called 'column_data'
observeEvent(input$file_chosen, {
  req(input$file_chosen)

  # Read the CSV file
  data <- read_csv(input$file_chosen$datapath, col_names = TRUE)
  
  # Store data frame selected by user.  Updated when different data frame is chosen by user  
  data_reactive(data)     

  # Store column names in imported data frame.  Updated when different data frame is chosen by user
  column_choices(names(data))
  
  # Store unique values of row contents of each column name.  Updated when different data frame is chosen by user
  column_data(lapply(data, unique))     
  
})   

```

<br>

### In the global r-chunk, 'column_choices' stores and updates column names available for selection during the runtime of the app.


```{r, eval=FALSE}


column_choices <- reactiveVal(NULL) 

```


### The Server monitors 'column_choices', creates inputID 'chart_title' and adds 'output$chart_title_selected' to the OUTPUT dataframe storing the title names selected by the User.


```{r, eval=FALSE}

# Generate dropdown of column names for chart title selection
output$chart_title_selected <- renderUI({
  req(column_choices())
  selectInput(
    inputId = "chart_title",
    label = "Select Columns for Chart Title:",
    choices = column_choices(),
    selected = column_choices()[1],  # Default to first column
    multiple = TRUE                  # Allow selecting multiple columns
  )
})


# inputID = "chart_title" populates this
# dropdown for Chart Title selection
uiOutput("chart_title_selected")      

```

### The Server also monitors 'column_choices', creates inputID 'chart_subtitle' and adds 'output$chart_sutitle_selected' to the OUTPUT dataframe storing the subtitle names selected by the User.


```{r, eval=FALSE}
}
# Generate dropdown of column names for chart subtitle selection
output$chart_subtitle_selected <- renderUI({
  req(column_choices())
  selectInput(
    inputId = "chart_subtitle",
    label = "Select Value for Chart Subtitle:",
    choices = column_choices(),                  # these are row names of selected columns
    selected = "year"                            # column_choices()[2] # Default selection
  )
})

# inputID = "chart_subtitle" populates this
# dropdown for Chart Subtitle column selection
uiOutput("chart_subtitle_selected")   

```


### The Server also monitors 'column_choices', creates inputID 'advanced_line_group' and adds 'output$advanced_line_group_selected' to the OUTPUT dataframe storing the names selected by the User.


```{r, eval=FALSE}

# ADVANCED multi-line chart dropdown (for multiple category selection)
output$advanced_line_group_selected <- renderUI({
  req(column_choices())
  selectizeInput(  # Using selectizeInput for better multiple selection
    inputId = "advanced_line_group",
    label = "For Line Charts:  Select Categories for Detailed Comparison:",
    choices = column_choices(),
    selected = "group",
    multiple = TRUE,  # Allow multiple selections
    options = list(plugins = list('remove_button'))
  )
})


# inputID = "advanced_line_group" populates this
# dropdown for selecting grouping variable(s) for all charts that can display more than 1 variable
uiOutput("advanced_line_group_selected")



```

<br>
### Store the names collected by the 'advanced_line_group' dropdown in the object 'groups_title'


```{r, eval=FALSE}

# Create a string containing all title names selected
groups_title <- paste(input$advanced_line_group, collapse = ", ")

```

<br>
This creates a string showing which columns are being used for grouping (from input$advanced_line_group), joining them with commas.

<br>
### Build Title Elements


```{r, eval=FALSE}

# Examines length of string in input$chart_title and prepares the 'title_elements' object based on length of string
title_elements <- c()                    # start with an empty vector
for(col_name in input$chart_title) {     # loop thru each column name in 'chart_title'
  if(col_name %in% names(data)) {        # if column name is within the names found in data frame
    if(length(unique(data[[col_name]])) == 1) {     # if the string has length of one
      title_elements <- c(title_elements, as.character(unique(data[[col_name]])))     # put that one name in the object 'title_elements'
    } else if(length(unique(data[[col_name]])) <= 5) {     # or, if the length is < 5, put the names into the object 'title_elements'
      values <- paste(unique(data[[col_name]]), collapse=", ")
      title_elements <- c(title_elements, values)
    } else {     # if there are more than 5 names, just pint 'x number of values'
      n_values <- length(unique(data[[col_name]]))
      title_elements <- c(title_elements, paste0(n_values, " Values"))
    }
  }
}

```

<br>
This code:

* Starts with an empty vector named title_elements
* Loops through each column selected in input$chart_title
* Adds title content based on the data in each column:

    - If there's only 1 unique value: uses that value
    - If there are 2-5 unique values: lists all values separated by commas
    - If there are more than 5 values: just shows the count (e.g., "10 Values")


<br>
### Create the Final Title Content object


```{r, eval=FALSE}

# Combine title elements if there is at least one value in the 'title_elements' string
title_content <- if (length(title_elements) > 0) {
  paste(title_elements, collapse = " - ")
} else {
  "Selected Data"
}

```

<br>
'title_content' now combines all collected title_elements, puts dashes between them, or uses "Selected Data" if nothing was collected.


<br>
### Format Title and Subtitle with HTML/CSS 

The entire formatted Title Elements are now stored in 'title_content'.'  (the Subtitle does not use the contents of 'title_content'

```{r, eval=FALSE}

# Create the final title and subtitle
title <- paste0(
  "<span style='color:darkorchid1'>",
  "Multi-Line Chart: ", 
  title_content,
  "</span>"
)

subtitle <- paste0(
  "for Years ", input$year_range[1], " - ", input$year_range[2]
  # " (Comparing by: ", groups_title, ")"
)

```


* The title gets HTML styling with darkorchid1 color and includes the combined title elements
* The subtitle shows the year range and what groups are being compared

<br>

### Apply Title and Subtitle to the Plot

```{r, eval=FALSE}

labs(
  title = title,
  subtitle = subtitle,
  caption = paste(" Comparison by ", groups_title),
  x = input$x_column,
  y = input$y_column,
  color = "Categories"  # Legend title
)

```

<br>
* The formatted strings are passed to the labs() function which sets them as the plot's title and subtitle.


### Style the Title and Subtitle

```{r, eval=FALSE}

theme(
  plot.title.position = "panel",
  plot.title = ggtext::element_markdown(
     color = "darkgreen",
     size = rel(1.25),
     face = "bold",
     lineheight = 1.3,
     margin = margin(0, 0, 0.25, 0, "lines")
  ),
  
  plot.subtitle = ggtext::element_markdown(
     color = "darkgreen",
     size = rel(1.10),
     face = "bold",
     lineheight = 1.3,
     margin = margin(0, 0, 0.5, 0, "lines")
  ),
 )

```

<br>
This applies specific styling to the title and subtitle:

* Uses element_markdown() to render HTML/CSS in the title
* Sets both to dark green color
* Makes the title 25% larger than base font
* Makes the subtitle 10% larger than base font
* Both are bold with specific line spacing and margins










